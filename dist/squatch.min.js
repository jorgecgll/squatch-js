!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.squatch=t():e.squatch=t()}(this,function(){return function(e){function t(n){if(o[n])return o[n].exports;var r=o[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var o={};return t.m=e,t.c=o,t.p="",t(0)}([function(e,t,o){e.exports=o(1)},function(e,t,o){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t["default"]=e,t}function r(e){return e&&e.__esModule?e:{"default":e}}function a(e){var t=void 0;switch(t=e instanceof Array?e[0]:e){case R.JS_API_INIT_CALL:d(e[1]);break;case R.JS_API_AUTOFILL_CALL:s(e[1]);break;case R.JS_API_GET_REWARD_BALANCES_CALL:p(e[1],e[2]);break;case R.JS_API_GET_FEATURE_REWARD_BALANCES_CALL:m(e[1],e[2]);break;case R.JS_API_GET_REWARD_CALL:l(e[1]);break;case R.JS_API_OPEN_CALL:b.open();break;case R.JS_API_CLOSE_CALL:b.close();break;case R.JS_API_SUBSCRIBE_CALL:D.subscribe(e[1],e[2]);break;default:console.error("Unknown method call `"+t+"`. Valid options are [init,autofill,getReward,getRewardBalance]")}}function i(e){e(document).ready(function(e){x=e,window.squatchQuery=e;for(var t=0;t<window._sqh.length;t++){var o=window._sqh[t];o[0]==R.JS_API_SUBSCRIBE_CALL&&(a(o),window._sqh.splice(t,1))}for(var n=-1,r=0;r<window._sqh.length;r++){var i=window._sqh[r];if(i[0]==R.JS_API_INIT_CALL){a(i),n=r;break}}n>-1?window._sqh.splice(n,1):console.error('Could not find "init" in the _sqh queue when squatch.js was loaded.')})}function u(e,t){window._sqh.push([e,t])}function d(e){if(k)return void(0,T["default"])("Should not call init more than once");k=!0,e.tenant_alias||console.error("tenant_alias must be set"),"undefined"!=typeof e.autofill&&u(R.JS_API_AUTOFILL_CALL,e.autofill);var t=void 0;if("undefined"==typeof e.account_id)t=C;else{if(j=!0,!e.user_id||!e.first_name)return void console.error("The user_id, email, first_name must be set");switch(e.last_name||((0,T["default"])("No last name set. Defaulting to empty"),e.last_name=""),"undefined"==typeof e.email&&(e.email=R.IGNORE_OPTIONAL_WIDGET_PARAM),"undefined"==typeof e.payment_provider_id?e.payment_provider_id=R.IGNORE_OPTIONAL_WIDGET_PARAM:null===e.payment_provider_id&&((0,T["default"])("Payment provider id provided, but is null. Default to special value"),e.payment_provider_id=R.UNREGISTERED_PAYMENTPROVIDER_PARAM),"undefined"==typeof e.checksum&&(e.checksum=R.IGNORE_OPTIONAL_WIDGET_PARAM),"undefined"==typeof e.jwt&&(e.jwt=R.IGNORE_OPTIONAL_WIDGET_PARAM),e.checksum==R.IGNORE_OPTIONAL_WIDGET_PARAM&&e.jwt==R.IGNORE_OPTIONAL_WIDGET_PARAM&&e.user_image&&e.user_image.len>0&&console.error("User images will not be accepted without signed requests."),e.checksum||e.jwt||(e.checksum||(e.checksum=""),e.jwt||(e.jwt=""),console.error("Checksum or JWT not set properly for signed widget request.")),"undefined"==typeof e.user_image?e.user_image=R.IGNORE_OPTIONAL_WIDGET_PARAM:e.user_image||((0,T["default"])("No user profile image set. Defaulting to gravatar"),e.user_image=""),"undefined"==typeof e.fb_share_image?e.fb_share_image=R.IGNORE_OPTIONAL_WIDGET_PARAM:e.fb_share_image||((0,T["default"])("No fb share image set. Defaulting to no image"),e.fb_share_image=""),"undefined"==typeof e.account_status?e.account_status=R.IGNORE_OPTIONAL_WIDGET_PARAM:e.account_status||((0,T["default"])("No account_status set. Defaulting to no account_status"),e.account_status=""),"undefined"==typeof e.referral_code?e.referral_code=R.IGNORE_OPTIONAL_WIDGET_PARAM:e.referral_code||((0,T["default"])("No referral_code set. Defaulting to no referral_code"),e.referral_code=""),"undefined"==typeof e.user_referral_code?e.user_referral_code=R.IGNORE_OPTIONAL_WIDGET_PARAM:e.user_referral_code||((0,T["default"])("No user_referral_code set. Defaulting to no user_referral_code"),e.user_referral_code=""),"undefined"==typeof e.locale?e.locale=R.IGNORE_OPTIONAL_WIDGET_PARAM:e.locale||((0,T["default"])("No locale set. Defaulting to no locale"),e.locale=""),e.mode=e.mode||0===e.mode?e.mode:W,e.mode){case R.NO_CONTENT_MODE:t=q;break;case R.EMBED_MODE:t=S;break;case R.POPUP_MODE:t=b;break;case R.DEMO_MODE:t=b;break;case R.DEMO_EMBED_MODE:t=S;break;default:console.error("Unsupported mode: '"+e.mode+"'. Please initialize with one of the following modes: 'NOCONTENT', 'EMBED', or 'POPUP'")}}t?(t===S&&x("#squatchembed").length<=0&&(e.mode=R.NO_CONTENT_MODE,t=q),x.ajaxSetup({cache:!0}),x.getScript(B+R.EASYXDM_PATH,function(){(0,T["default"])("easyXDM loaded"),t.create(e,x,B,c)}).fail(P["default"])):(0,T["default"])("No widget being embedded. Probably because of a lack of configuration.")}function c(e,t){if("undefined"==typeof e||!e){J=t;for(var o=window._sqh.shift();o;)a(o),o=window._sqh.shift();window._sqh.push=function(){for(var e=0;e<arguments.length;e++)a(arguments[e]);return Array.prototype.push.apply(this,arguments)}}}function s(e){"string"==typeof e?J.code&&x(e).val(J.code):"function"==typeof e?e(J.code):console.error('The "autofill" method should be called with either a jQuery selector or a callback. Unknown type '+("undefined"==typeof e?"undefined":A(e)))}function l(e){"function"==typeof e?j?e(_()):console.error("Unsupported reward lookup widget push, you need to push with an account Id to use this feature"):console.error("Unsupported widget reward lookup push, invalid params.")}function _(){var e={};if(J.rewardBalance)for(var t=0;t<J.rewardBalance.length;t++)"PCT_DISCOUNT"==J.rewardBalance[t].type&&(e=J.rewardBalance[t]);else console.warn("Reward balance could not be found, it may not be implemented in your widget theme.");return"undefined"!=typeof e.type?{type:"PCT_DISCOUNT",details:{discountPercentage:e.totalDiscountPercent,referrerDiscountPercent:e.referrerDiscountPercent,referredDiscountPercent:e.referredDiscountPercent}}:{type:"PCT_DISCOUNT",details:{discountPercentage:0,referrerDiscountPercent:0,referredDiscountPercent:0}}}function f(e){var t=[];if(J.rewardBalance)for(var o=0;o<J.rewardBalance.length;o++)J.rewardBalance[o].type==e&&t.push(J.rewardBalance[o]);else console.warn("Reward balance could not be found, it may not be implemented in your widget theme.");return t}function p(e,t){j?"string"==typeof e?"function"==typeof t?t(f(e)):console.error("Unsupported widget reward type lookup push, invalid params."):"function"==typeof e?e(J.rewardBalance):console.error("Unsupported widget reward lookup push, invalid params."):console.error("Unsupported reward lookup widget push, you need to push with an account Id to use this feature")}function m(e,t){if(j)if("string"==typeof e&&"function"==typeof t){for(var o=f("FEATURE"),n=[],r=0;r<o.length;r++)o[r].featureType==e&&n.push(o[r]);t(n)}else console.error("Unsupported widget reward type lookup push, invalid params.");else console.error("Unsupported reward lookup widget push, you need to push with an account Id to use this feature")}function E(){"undefined"==typeof _sqh?console.error("_sqh must be defined and initialized to use this widget.\n         To initialize the popup widget call: \n         _sqh.push(['init',\n            {tenant_alias: '$yourTenantAlias', \n            account_id: '$viewingCustomerAccountId',\n            email: '$viewingCustomerEmail', \n            user_id : '$viewingUserId', \n            first_name: '$viewingCustomerFirstName', \n            last_name: '$viewingCustomerLastName'\n         ]}]);"):(0,h["default"])(10,function(e){return e?(B=e,void(0,g["default"])(e+R.JQUERY_PATH,function(e){i(e)})):void console.error("Could not find properly formatted squatch.js DOM scripts")})}Object.defineProperty(t,"__esModule",{value:!0});var A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},O=o(2),h=r(O),I=o(5),g=r(I),w=o(6),P=r(w),y=o(3),T=r(y),v=o(4),R=n(v),M=o(7),D=n(M),N=o(9),b=n(N),L=o(10),C=n(L),G=o(11),S=n(G),U=o(12),q=n(U),W=R.POPUP_MODE,B=null,k=!1,j=!1,J=null,x=null;E();var F="v1.0.0";t["default"]=F},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){var o=document.getElementsByTagName("script"),n=o[o.length-1],r=n.src,a=r.substr(0,r.lastIndexOf("/")+1);t(a)}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=r;var a=o(3);n(a),o(4)},function(e,t){"use strict";function o(){n&&window.console&&console.log.apply(console,arguments)}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=o;var n=!0;window.console&&console.log||(console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){}})},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.JS_API_INIT_CALL="init",t.JS_API_AUTOFILL_CALL="autofill",t.JS_API_GET_REWARD_BALANCES_CALL="getRewardBalance",t.JS_API_GET_FEATURE_REWARD_BALANCES_CALL="getRewardFeatureBalance",t.JS_API_GET_REWARD_CALL="getReward",t.JS_API_OPEN_CALL="open",t.JS_API_CLOSE_CALL="close",t.JS_API_SUBSCRIBE_CALL="subscribe",t.NO_CONTENT_MODE="NOCONTENT",t.EMBED_MODE="EMBED",t.POPUP_MODE="POPUP",t.DEMO_MODE="DEMO",t.DEMO_EMBED_MODE="DEMO_EMBED",t.DEFAULT_AUTO_OPEN="squatch_open",t.IGNORE_OPTIONAL_WIDGET_PARAM="_IGNORE_",t.UNREGISTERED_PAYMENTPROVIDER_PARAM="UNREGISTERED",t.SQUATCHJS_SCRIPT_NAME_REGEX=/squatch(\.min)?\.js(\?.*)*$/,t.JQUERY_PATH="/external/jquery-1.9.0.min.js",t.JQUERY_REVEAL_PATH="/external/reveal.js",t.JQUERY_REVEAL_CSS_PATH="/external/reveal.css",t.EASYXDM_PATH="/external/easyXDM.min.js"},function(e,t){"use strict";function o(e,t){var o=function(){var e=window.jQuery.noConflict(!0);t(e)},n=new RegExp("[1].[7-9](.[0-9])?");if(void 0!==window.jQuery&&n.test(window.jQuery.fn.jquery))t(window.jQuery);else{var r=document.createElement("script");r.setAttribute("type","text/javascript"),r.setAttribute("src",e),r.readyState?r.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||o()}:r.onload=o,(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(r)}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=o},function(e,t){"use strict";function o(){0==arguments[0].readyState?console.error("Failed to load script"):console.error("Failed to parse script: "+arguments[2].toString())}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=o},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){var o=t.framediv,n=t.callback,r=t.closeFnc,a=t.pageType,i=(0,c.getFrameUrl)(e,a),l=!0,_=new window.easyXDM.Rpc({remote:i,container:o,props:{allowtransparency:"true",scrolling:"no",marginwidth:"0",marginheight:"0",frameborder:"no"}},{local:{init:function(t,r,a,i,c){(0,u["default"])("got init message"),l=c,o.getElementsByTagName("iframe")[0].style.height=t+"px",o.getElementsByTagName("iframe")[0].style.width=e.mode!=d.EMBED_MODE&&e.mode!=d.DEMO_EMBED_MODE||l?r+"px":"100%";var s={code:a,rewardBalance:i};n(!1,s)},resize:function(t,n){(0,u["default"])("got resize message"),o.getElementsByTagName("iframe")[0].style.height=t+"px",o.getElementsByTagName("iframe")[0].style.width=e.mode!=d.EMBED_MODE&&e.mode!=d.DEMO_EMBED_MODE||l?n+"px":"100%",window.dispatchEvent(new window.Event("resize.modal"))},publish:function(e,t){if((0,u["default"])("got publish message"),s[e])for(var o=0;o<s[e].length;o++)s[e][o](t)},close:function(){(0,u["default"])("got close message"),r()},error:function(t,r,a){console.error(t),l=!1,o.getElementsByTagName("iframe")[0].style.height=e.mode==d.EMBED_MODE||e.mode==d.DEMO_EMBED_MODE?"100%":r+"px",o.getElementsByTagName("iframe")[0].style.width=e.mode==d.EMBED_MODE||e.mode==d.DEMO_EMBED_MODE?"100%":a+"px",n(!0)}},remote:{openedWidget:{},closedWidget:{}}});return _}function a(e,t){s[e]||(s[e]=[]),s[e].push(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.setup=r,t.subscribe=a;var i=o(3),u=n(i),d=o(4),c=o(8),s={}},function(e,t,o){"use strict";function n(e){var t="undefined"==typeof e.host?"app.referralsaasquatch.com":e.host;return window.location.protocol+"//"+t+"/a/"+e.tenant_alias+"/"}function r(e,t){var o=void 0,r=void 0;e.payment_provider_id==a.IGNORE_OPTIONAL_WIDGET_PARAM?(o=e.account_id,r=a.IGNORE_OPTIONAL_WIDGET_PARAM):e.payment_provider_id==a.UNREGISTERED_PAYMENTPROVIDER_PARAM?(o=a.IGNORE_OPTIONAL_WIDGET_PARAM,r=e.account_id):(o=e.payment_provider_id,r=null===e.account_id?"":e.account_id);var i=void 0;return i=r!=a.IGNORE_OPTIONAL_WIDGET_PARAM?"systemId="+encodeURIComponent(r)+(o!=a.IGNORE_OPTIONAL_WIDGET_PARAM?"&paymentProviderId="+encodeURIComponent(o):""):o!=a.IGNORE_OPTIONAL_WIDGET_PARAM?"paymentProviderId="+encodeURIComponent(o):"",n(e)+"widgets/squatchwidget?"+i+"&userId="+encodeURIComponent(e.user_id)+(e.email!=a.IGNORE_OPTIONAL_WIDGET_PARAM?"&email="+encodeURIComponent(e.email):"")+"&firstName="+encodeURIComponent(e.first_name)+"&lastName="+encodeURIComponent(e.last_name)+(e.user_image!=a.IGNORE_OPTIONAL_WIDGET_PARAM?"&userImage="+encodeURIComponent(e.user_image):"")+(e.checksum!=a.IGNORE_OPTIONAL_WIDGET_PARAM?"&paramChecksum="+encodeURIComponent(e.checksum):"")+(e.jwt!=a.IGNORE_OPTIONAL_WIDGET_PARAM?"&paramJwt="+encodeURIComponent(e.jwt):"")+(e.locale!=a.IGNORE_OPTIONAL_WIDGET_PARAM?"&locale="+encodeURIComponent(e.locale):"")+(e.fb_share_image!=a.IGNORE_OPTIONAL_WIDGET_PARAM?"&fbShareImage="+encodeURIComponent(e.fb_share_image):"")+(e.account_status!=a.IGNORE_OPTIONAL_WIDGET_PARAM?"&accountStatus="+encodeURIComponent(e.account_status):"")+(e.referral_code!=a.IGNORE_OPTIONAL_WIDGET_PARAM?"&referralCode="+encodeURIComponent(e.referral_code):"")+(e.user_referral_code!=a.IGNORE_OPTIONAL_WIDGET_PARAM?"&userReferralCode="+encodeURIComponent(e.user_referral_code):"")+"&pageType="+t+"&mode="+e.mode}Object.defineProperty(t,"__esModule",{value:!0}),t.getTenantHost=n,t.getFrameUrl=r;var a=o(4)},function(e,t,o){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t["default"]=e,t}function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t,o,n){(0,s["default"])("loading popup widget");var r=t("<link>",{rel:"stylesheet",type:"text/css",href:o+m.JQUERY_REVEAL_CSS_PATH});r.appendTo("head"),t.getScript(o+m.JQUERY_REVEAL_PATH,function(){(0,s["default"])("reveal loaded");var o=document.createElement("div");o.setAttribute("id","squatchModal"),o.setAttribute("class","reveal-modal"),t("<div></div>").attr("id","squatchModalWrapper").append(o).appendTo("body"),E=t("#squatchModalWrapper");var r={framediv:o,callback:n,closeFnc:function(){t("#squatchModalWrapper").trigger("squatch:close")},pageType:"modalPopup"},a=p.setup(e,r);t("#squatchModalWrapper").on("reveal:close","#squatchModal",function(){a.closedWidget()}),t("body").on("click",".squatchpop",function(e){e.preventDefault(),t("#squatchModalWrapper").trigger("squatch:open")}),E.on("squatch:close",function(e){t("#squatchModal").trigger("reveal:close")}),E.on("squatch:open",function(o){a.openedWidget(e.mode,e.user_id,e.account_id),t("#squatchModal").reveal()}),d(e,t)}).fail(_["default"])}function i(){return E?void E.dispatchEvent(new window.Event("squatch:open")):void console.error("The squatch widget must be loaded in popup mode to be opened")}function u(){return E?void E.dispatchEvent(new window.Event("squatch:close")):void console.error("The squatch widget must be loaded in popup mode to be closed")}function d(e,t){for(var o=!1,n=e.auto_open_param?e.auto_open_param:m.DEFAULT_AUTO_OPEN,r=window.location.search.substring(1),a=r.split("&"),u=0;u<a.length;u++)a[u]===n&&!function(){var e=setInterval(function(){t(document).ready(function(){i(),o=!0}),o&&clearInterval(e)},1e3)}()}Object.defineProperty(t,"__esModule",{value:!0}),t.create=a,t.open=i,t.close=u;var c=o(3),s=r(c),l=o(6),_=r(l),f=o(7),p=n(f),m=o(4),E=null},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t,o,n){(0,i["default"])("loading cookie code widget");var r=(0,u.getTenantHost)(e)+"widgets/squatchcookie",a=new window.easyXDM.Rpc({remote:r},{local:{init:function(e){(0,i["default"])("got init message");var t={code:e};n(!1,t)}}});return a}Object.defineProperty(t,"__esModule",{value:!0}),t.create=r;var a=o(3),i=n(a),u=o(8)},function(e,t,o){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t["default"]=e,t}function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t,o,n){(0,u["default"])("loading embed widget");var r=document.createElement("div");t("<div></div>").hide().attr("id","squatchEmbedWrapper").append(r).insertAfter(t("#squatchembed"));var a={framediv:r,callback:function(e,o){setTimeout(function(){t("#squatchembed").hide(),t("#squatchEmbedWrapper").show(),n(e,o)},500)},closeFnc:function(){},pageType:"embeddedWidget"},i=c.setup(e,a);return i.openedWidget(e.mode,e.user_id,e.account_id),i}Object.defineProperty(t,"__esModule",{value:!0}),t.create=void 0;var i=o(3),u=r(i),d=(o(4),o(7)),c=n(d);t.create=a},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function r(e,t,o,n){var r=(0,u.getFrameUrl)(e,""),a=document.createElement("div");t("<div></div>").hide().append(a).appendTo("body");var d=new window.easyXDM.Rpc({remote:r,container:a,props:{allowtransparency:"true",scrolling:"no",marginwidth:"0",marginheight:"0",frameborder:"no"}},{local:{init:function(e,t){(0,i["default"])("got init message");var o={code:e,reward:t};n(!1,o)},error:function(e){console.error(e)}}});return d}Object.defineProperty(t,"__esModule",{value:!0}),t.create=r;var a=o(3),i=n(a),u=o(8)}])});